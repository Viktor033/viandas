<app-navbar></app-navbar>

<div class="dashboard-container">
    <div class="header-section">
        <h1>Gestión de Clientes</h1>
        <button class="btn-primary" (click)="openModal()">
            <i class="fas fa-plus"></i> Nuevo Cliente
        </button>
    </div>

    <div class="table-responsive">
        <table class="clientes-table">
            <thead>
                <tr>
                    <th>Nombre y Apellido</th>
                    <th>Teléfono</th>
                    <th>Dirección</th>
                    <th>Zona</th>
                    <th>Cadete</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let cliente of clientes">
                    <td>{{ cliente.nombre }} {{ cliente.apellido }}</td>
                    <td>{{ cliente.telefono }}</td>
                    <td>
                        {{ cliente.direccion }}
                        <span *ngIf="cliente.piso || cliente.departamento" class="small-text">
                            ({{ cliente.piso }} {{ cliente.departamento }})
                        </span>
                    </td>
                    <td><span class="badge zona" *ngIf="cliente.zona">{{ cliente.zona }}</span></td>
                    <td>
                        <span class="badge cadete" [class.assigned]="cliente.cadete">
                            {{ cliente.cadete ? cliente.cadete.nombre : 'Sin asignar' }}
                        </span>
                    </td>
                    <td class="actions-cell">
                        <button class="btn-icon print" (click)="printFicha(cliente)" title="Imprimir Ficha">
                            <i class="fas fa-print"></i>
                        </button>
                        <button class="btn-icon edit" (click)="openModal(cliente)" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-icon delete" (click)="deleteCliente(cliente.id!)" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
                <tr *ngIf="clientes.length === 0">
                    <td colspan="6" class="empty-message">No hay clientes registrados</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Form -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="closeModal()">&times;</button>
        <h2>{{ isEditing ? 'Editar Cliente' : 'Nuevo Cliente' }}</h2>
        
        <form (ngSubmit)="saveCliente()">
            <div class="form-row">
                <div class="form-group half">
                    <label>Nombre</label>
                    <input [(ngModel)]="currentCliente.nombre" name="nombre" required>
                </div>
                <div class="form-group half">
                    <label>Apellido</label>
                    <input [(ngModel)]="currentCliente.apellido" name="apellido" required>
                </div>
            </div>

            <div class="form-group">
                <label>Teléfono (ID Acceso)</label>
                <input [(ngModel)]="currentCliente.telefono" name="telefono" required>
            </div>

            <div class="form-group">
                <label>Dirección</label>
                <input [(ngModel)]="currentCliente.direccion" name="direccion" placeholder="Calle y Altura">
            </div>

            <div class="form-row">
                <div class="form-group third">
                    <label>Piso</label>
                    <input [(ngModel)]="currentCliente.piso" name="piso">
                </div>
                <div class="form-group third">
                    <label>Depto</label>
                    <input [(ngModel)]="currentCliente.departamento" name="depto">
                </div>
                <div class="form-group third">
                    <label>Zona</label>
                    <input [(ngModel)]="currentCliente.zona" name="zona" placeholder="Ej: CENTRO">
                </div>
            </div>

            <div class="form-group">
                <label>Observaciones</label>
                <textarea [(ngModel)]="currentCliente.observaciones" name="obs" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label>Cadete Asignado</label>
                <select [(ngModel)]="currentCliente.cadete" name="cadete">
                    <option [ngValue]="null">-- Sin Asignar --</option>
                    <option *ngFor="let c of cadetes" [ngValue]="c">
                        {{ c.nombre }} ({{ c.vehiculo }})
                    </option>
                </select>
            </div>

            <button type="submit" class="btn-submit">Guardar</button>
        </form>
    </div>
</div>
