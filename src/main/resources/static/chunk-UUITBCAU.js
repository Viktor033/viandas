import{a as q}from"./chunk-OW36UBQK.js";import{a as G}from"./chunk-THZBDTP5.js";import{c as U,d as j}from"./chunk-GMOZJTMW.js";import{b as V,c as T,d as W,e as z,f as N,g as I,j as F,k as B,l as D,m as L,n as R}from"./chunk-WBCBZC34.js";import{C as y,G as f,J as _,K as S,M as i,N as o,O as x,P as O,Q as u,R as d,T as a,U as M,V as P,W as h,X as g,Y as p,Z as C,d as Z,ja as E,ka as k,o as v,pa as A,q as s,r as m,z as l}from"./chunk-GBG54TIV.js";var w=Z(U());function J(c,b){if(c&1&&(i(0,"span",19),a(1),o()),c&2){let e=d().$implicit;l(),h(" (",e.piso," ",e.departamento,") ")}}function H(c,b){if(c&1&&(i(0,"span",20),a(1),o()),c&2){let e=d().$implicit;l(),M(e.zona)}}function K(c,b){if(c&1){let e=O();i(0,"tr")(1,"td"),a(2),o(),i(3,"td"),a(4),o(),i(5,"td"),a(6),f(7,J,2,2,"span",9),o(),i(8,"td"),f(9,H,2,1,"span",10),o(),i(10,"td")(11,"span",11),a(12),o()(),i(13,"td",12)(14,"button",13),u("click",function(){let t=s(e).$implicit,r=d();return m(r.printFicha(t))}),x(15,"i",14),o(),i(16,"button",15),u("click",function(){let t=s(e).$implicit,r=d();return m(r.openModal(t))}),x(17,"i",16),o(),i(18,"button",17),u("click",function(){let t=s(e).$implicit,r=d();return m(r.deleteCliente(t.id))}),x(19,"i",18),o()()()}if(c&2){let e=b.$implicit;l(2),h("",e.nombre," ",e.apellido,""),l(2),M(e.telefono),l(2),P(" ",e.direccion," "),l(),_("ngIf",e.piso||e.departamento),l(2),_("ngIf",e.zona),l(2),S("assigned",e.cadete),l(),P(" ",e.cadete?e.cadete.nombre:"Sin asignar"," ")}}function Q(c,b){c&1&&(i(0,"tr")(1,"td",21),a(2,"No hay clientes registrados"),o()())}function X(c,b){if(c&1&&(i(0,"option",39),a(1),o()),c&2){let e=b.$implicit;_("ngValue",e),l(),h(" ",e.nombre," (",e.vehiculo,") ")}}function Y(c,b){if(c&1){let e=O();i(0,"div",22),u("click",function(){s(e);let t=d();return m(t.closeModal())}),i(1,"div",23),u("click",function(t){return s(e),m(t.stopPropagation())}),i(2,"button",24),u("click",function(){s(e);let t=d();return m(t.closeModal())}),a(3,"\xD7"),o(),i(4,"h2"),a(5),o(),i(6,"form",25),u("ngSubmit",function(){s(e);let t=d();return m(t.saveCliente())}),i(7,"div",26)(8,"div",27)(9,"label"),a(10,"Nombre"),o(),i(11,"input",28),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.nombre,t)||(r.currentCliente.nombre=t),m(t)}),o()(),i(12,"div",27)(13,"label"),a(14,"Apellido"),o(),i(15,"input",29),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.apellido,t)||(r.currentCliente.apellido=t),m(t)}),o()()(),i(16,"div",30)(17,"label"),a(18,"Tel\xE9fono (ID Acceso)"),o(),i(19,"input",31),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.telefono,t)||(r.currentCliente.telefono=t),m(t)}),o()(),i(20,"div",30)(21,"label"),a(22,"Direcci\xF3n"),o(),i(23,"input",32),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.direccion,t)||(r.currentCliente.direccion=t),m(t)}),o()(),i(24,"div",26)(25,"div",33)(26,"label"),a(27,"Piso"),o(),i(28,"input",34),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.piso,t)||(r.currentCliente.piso=t),m(t)}),o()(),i(29,"div",33)(30,"label"),a(31,"Depto"),o(),i(32,"input",35),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.departamento,t)||(r.currentCliente.departamento=t),m(t)}),o()(),i(33,"div",33)(34,"label"),a(35,"Zona"),o(),i(36,"input",36),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.zona,t)||(r.currentCliente.zona=t),m(t)}),o()()(),i(37,"div",30)(38,"label"),a(39,"Observaciones"),o(),i(40,"textarea",37),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.observaciones,t)||(r.currentCliente.observaciones=t),m(t)}),o()(),i(41,"div",30)(42,"label"),a(43,"Cadete Asignado"),o(),i(44,"select",38),C("ngModelChange",function(t){s(e);let r=d();return p(r.currentCliente.cadete,t)||(r.currentCliente.cadete=t),m(t)}),i(45,"option",39),a(46,"-- Sin Asignar --"),o(),f(47,X,2,3,"option",40),o()(),i(48,"button",41),a(49,"Guardar"),o()()()()}if(c&2){let e=d();l(5),M(e.isEditing?"Editar Cliente":"Nuevo Cliente"),l(6),g("ngModel",e.currentCliente.nombre),l(4),g("ngModel",e.currentCliente.apellido),l(4),g("ngModel",e.currentCliente.telefono),l(4),g("ngModel",e.currentCliente.direccion),l(5),g("ngModel",e.currentCliente.piso),l(4),g("ngModel",e.currentCliente.departamento),l(4),g("ngModel",e.currentCliente.zona),l(4),g("ngModel",e.currentCliente.observaciones),l(4),g("ngModel",e.currentCliente.cadete),l(),_("ngValue",null),l(2),_("ngForOf",e.cadetes)}}var de=(()=>{class c{clienteService=v(q);cadeteService=v(G);clientes=[];cadetes=[];showModal=!1;isEditing=!1;currentCliente=this.getEmptyCliente();ngOnInit(){this.loadClientes(),this.loadCadetes()}loadClientes(){this.clienteService.getClientes().subscribe({next:e=>this.clientes=e.filter(n=>n.rol!=="ADMIN"&&n.activo!==!1),error:e=>console.error(e)})}loadCadetes(){this.cadeteService.getCadetes().subscribe({next:e=>this.cadetes=e.filter(n=>n.activo),error:e=>console.error(e)})}openModal(e){if(e){if(this.isEditing=!0,this.currentCliente=JSON.parse(JSON.stringify(e)),this.currentCliente.cadete){let n=this.cadetes.find(t=>t.id===this.currentCliente.cadete?.id);n&&(this.currentCliente.cadete=n)}}else this.isEditing=!1,this.currentCliente=this.getEmptyCliente();this.showModal=!0}closeModal(){this.showModal=!1}saveCliente(){(this.isEditing&&this.currentCliente.id?this.clienteService.updateCliente(this.currentCliente.id,this.currentCliente):this.clienteService.createCliente(this.currentCliente)).subscribe({next:()=>{this.showSuccess(this.isEditing?"Cliente actualizado":"Cliente creado"),this.loadClientes(),this.closeModal()},error:n=>{let t=n.error?.message||n.message||"Error desconocido";this.showError(`Error: ${t}`)}})}printFicha(e){let n=window.open("","","height=600,width=800");n&&(n.document.write("<html><head><title>Ficha de Cliente</title>"),n.document.write("<style>"),n.document.write("body { font-family: Arial, sans-serif; padding: 20px; }"),n.document.write(".header { text-align: center; border-bottom: 2px solid #333; margin-bottom: 20px; }"),n.document.write(".row { margin-bottom: 15px; font-size: 1.2rem; }"),n.document.write(".label { font-weight: bold; width: 150px; display: inline-block; }"),n.document.write(".zone-tag { border: 2px solid black; padding: 5px 10px; font-size: 1.5rem; font-weight: bold; }"),n.document.write("</style>"),n.document.write("</head><body>"),n.document.write('<div class="header"><h1>Ficha de Entrega - MANOPLAS</h1></div>'),n.document.write(`<div class="row"><span class="label">Cliente:</span> ${e.nombre} ${e.apellido}</div>`),n.document.write(`<div class="row"><span class="label">Tel\xE9fono:</span> ${e.telefono}</div>`),n.document.write(`<div class="row"><span class="label">Direcci\xF3n:</span> ${e.direccion||"-"}</div>`),(e.piso||e.departamento)&&n.document.write(`<div class="row"><span class="label">Piso/Depto:</span> ${e.piso||""} ${e.departamento||""}</div>`),n.document.write(`<div class="row"><span class="label">Zona:</span> <span class="zone-tag">${e.zona||"SIN ZONA"}</span></div>`),n.document.write(`<div class="row"><span class="label">Observaciones:</span> ${e.observaciones||"Ninguna"}</div>`),n.document.write(`<div class="row"><span class="label">Cadete Asignado:</span> ${e.cadete?e.cadete.nombre:"NO ASIGNADO"}</div>`),n.document.write("</body></html>"),n.document.close(),n.print())}deleteCliente(e){w.default.fire({title:"\xBFEliminar Cliente?",text:"Esta acci\xF3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ff6b6b",cancelButtonColor:"#6c757d",confirmButtonText:"S\xED, eliminar",background:"#1a1a1a",color:"#f8edda"}).then(n=>{n.isConfirmed&&this.clienteService.deleteCliente(e).subscribe({next:()=>{this.showSuccess("Cliente eliminado"),this.clientes=this.clientes.filter(t=>t.id!==e),this.loadClientes()},error:t=>{console.error("SERVER ERROR DELETE:",t),this.showError("Algo fall\xF3: "+(t.error?.message||t.statusText))}})})}getEmptyCliente(){return{nombre:"",apellido:"",telefono:"",rol:"USUARIO",activo:!0,zona:"",direccion:"",piso:"",departamento:"",observaciones:""}}showSuccess(e){w.default.fire({icon:"success",title:"\xC9xito",text:e,timer:1500,showConfirmButton:!1,background:"#1a1a1a",color:"#f8edda"})}showError(e){w.default.fire({icon:"error",title:"Error",text:e,background:"#1a1a1a",color:"#f8edda"})}static \u0275fac=function(n){return new(n||c)};static \u0275cmp=y({type:c,selectors:[["app-admin-clientes"]],decls:28,vars:3,consts:[[1,"dashboard-container"],[1,"header-section"],[1,"btn-primary",3,"click"],[1,"fas","fa-plus"],[1,"table-responsive"],[1,"clientes-table"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],["class","small-text",4,"ngIf"],["class","badge zona",4,"ngIf"],[1,"badge","cadete"],[1,"actions-cell"],["title","Imprimir Ficha",1,"btn-icon","print",3,"click"],[1,"fas","fa-print"],["title","Editar",1,"btn-icon","edit",3,"click"],[1,"fas","fa-edit"],["title","Eliminar",1,"btn-icon","delete",3,"click"],[1,"fas","fa-trash"],[1,"small-text"],[1,"badge","zona"],["colspan","6",1,"empty-message"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"close-btn",3,"click"],[3,"ngSubmit"],[1,"form-row"],[1,"form-group","half"],["name","nombre","required","",3,"ngModelChange","ngModel"],["name","apellido","required","",3,"ngModelChange","ngModel"],[1,"form-group"],["name","telefono","required","",3,"ngModelChange","ngModel"],["name","direccion","placeholder","Calle y Altura",3,"ngModelChange","ngModel"],[1,"form-group","third"],["name","piso",3,"ngModelChange","ngModel"],["name","depto",3,"ngModelChange","ngModel"],["name","zona","placeholder","Ej: CENTRO",3,"ngModelChange","ngModel"],["name","obs","rows","2",3,"ngModelChange","ngModel"],["name","cadete",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","submit",1,"btn-submit"]],template:function(n,t){n&1&&(x(0,"app-navbar"),i(1,"div",0)(2,"div",1)(3,"h1"),a(4,"Gesti\xF3n de Clientes"),o(),i(5,"button",2),u("click",function(){return t.openModal()}),x(6,"i",3),a(7," Nuevo Cliente "),o()(),i(8,"div",4)(9,"table",5)(10,"thead")(11,"tr")(12,"th"),a(13,"Nombre y Apellido"),o(),i(14,"th"),a(15,"Tel\xE9fono"),o(),i(16,"th"),a(17,"Direcci\xF3n"),o(),i(18,"th"),a(19,"Zona"),o(),i(20,"th"),a(21,"Cadete"),o(),i(22,"th"),a(23,"Acciones"),o()()(),i(24,"tbody"),f(25,K,20,9,"tr",6)(26,Q,3,0,"tr",7),o()()()(),f(27,Y,50,12,"div",8)),n&2&&(l(25),_("ngForOf",t.clientes),l(),_("ngIf",t.clientes.length===0),l(),_("ngIf",t.showModal))},dependencies:[A,E,k,j,R,I,B,D,V,F,T,W,L,N,z],styles:[".dashboard-container[_ngcontent-%COMP%]{min-height:100vh;padding-top:100px;padding-bottom:2rem;padding-left:1rem;padding-right:1rem;background-color:var(--bg-color);font-family:Segoe UI,sans-serif;color:var(--text-color);position:relative}.dashboard-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{position:relative;z-index:1;max-width:1400px;margin:0 auto}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;color:var(--primary-color);text-transform:uppercase;letter-spacing:2px}.header-section[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;border:none;padding:.8rem 1.5rem;border-radius:8px;font-weight:700;cursor:pointer;transition:transform .2s}.header-section[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.table-responsive[_ngcontent-%COMP%]{background:var(--bg-card);border-radius:12px;padding:1rem;box-shadow:var(--card-shadow);border:1px solid rgba(0,0,0,.05);overflow-x:auto}.clientes-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;min-width:900px}.clientes-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .clientes-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid rgba(0,0,0,.1);color:var(--text-color)}.clientes-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:var(--primary-color);text-transform:uppercase;font-size:.9rem}.clientes-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:.95rem;vertical-align:middle}.clientes-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .small-text[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-muted);display:block}.clientes-table[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:.3rem .8rem;border-radius:20px;font-size:.8rem;font-weight:400}.clientes-table[_ngcontent-%COMP%]   .badge.zona[_ngcontent-%COMP%]{background:#0000000d;color:#000!important;border:1px solid var(--primary-color);font-weight:400!important}.clientes-table[_ngcontent-%COMP%]   .badge.cadete[_ngcontent-%COMP%]{background:#0000000d;color:var(--text-muted)}.clientes-table[_ngcontent-%COMP%]   .badge.cadete.assigned[_ngcontent-%COMP%]{background:#edb11033;color:#000!important;font-weight:400!important}.clientes-table[_ngcontent-%COMP%]   .actions-cell[_ngcontent-%COMP%]{display:flex;gap:.5rem}.clientes-table[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:.5rem;border-radius:50%;transition:background .2s}.clientes-table[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}.clientes-table[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]{color:var(--text-color)}.clientes-table[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:hover{background:#0000000d}.clientes-table[_ngcontent-%COMP%]   .btn-icon.print[_ngcontent-%COMP%]{color:var(--primary-color)}.clientes-table[_ngcontent-%COMP%]   .btn-icon.print[_ngcontent-%COMP%]:hover{background:#edb1101a}.clientes-table[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]{color:#ff6b6b}.clientes-table[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]:hover{background:#ff6b6b1a;transform:scale(1.1)}.clientes-table[_ngcontent-%COMP%]   .empty-message[_ngcontent-%COMP%]{text-align:center;padding:2rem;opacity:.6}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:var(--bg-card);padding:2rem;border-radius:12px;width:90%;max-width:600px;border:1px solid var(--border-color);color:var(--text-color);position:relative;max-height:90vh;overflow-y:auto;box-shadow:var(--card-shadow)}.modal-content[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--text-color);font-size:1.5rem;cursor:pointer}.modal-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--primary-color);margin-bottom:2rem;text-align:center;border-bottom:1px solid rgba(0,0,0,.1);padding-bottom:1rem}.modal-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.modal-content[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}.modal-content[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]   .half[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]   .third[_ngcontent-%COMP%]{flex:1}.modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;color:var(--text-color);font-weight:500;font-size:.9rem}.modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:.8rem;background:var(--bg-color);border:1px solid rgba(0,0,0,.1);color:var(--text-color);border-radius:6px;font-family:inherit}.modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color)}.modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical}.modal-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background:var(--bg-card);color:var(--text-color)}.modal-content[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background:var(--primary-color);color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer}.modal-content[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]:hover{filter:brightness(1.1)}@media (max-width: 768px){.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:0}}"]})}return c})();export{de as AdminClientesComponent};
